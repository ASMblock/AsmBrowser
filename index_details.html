<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="applicable-device" content="pc,mobile">
    <title>ASM Explorer</title>
    <link rel="shortcut icon"  href="images/asm_logo_gold.png" style="width: 12px;height: 12px;" >
    <link rel="stylesheet" href="css/bootstrap.min.css?v=1.7">
    <link rel="stylesheet" href="css/common.css?v=1.7">
    <link rel="stylesheet" href="css/index.css?v=1.7">
    <link rel="stylesheet" href="css/switch.css?v=1.7">
    <link rel="stylesheet" type="text/css" href="css/page.css?v=1.7">
</head>
<style>
    html {
        min-height: 100%;
    }
</style>
<body id="translation">
    <!-- PC端导航 -->
<div class="nav" style="display: block;">
        <div class="content">
          <a href="index.html" class="logo"><img src="images/asm_logo_gold.png" alt=""><span class="tra1">Explorer</span></a>
          <ul>
            <li><a href="index.html" class="tra2">Home</a></li>
            <li class="dropmenu_link">
              <a href="javascript:;" class="tra3">Blockchain<span class="arrow"></span></a>
              <div class="other_link_list">
                <ul>
                  <li><a href="blockList.html" id="goBlockList" class="tra4">Block</a></li>
                  <li><a href="payList.html" id="goPayList" class="tra5">Transaction</a></li>
                  <!-- <li><a href="#">未确认交易</a></li> -->
                </ul>
              </div>
            </li>
            <li><a href="https://github.com/ASMblock" class="tra6">About us</a></li>
          </ul>
          <div class="language">
            <div class="selected">
              <span id="translateI">English</span><i></i>
              <div class="languagelist">
                  <ul>
                    <li><a href="javascript:;">简体中文</a></li>
                    <li><a href="javascript:;">English</a></li>
                    <!-- <li><a href="javascript:;">한국어</a></li> -->
                  </ul>
                </div>
            </div>
          </div>
          <!-- <div class="daytab"><span class="night"></span><span class="daytime"></span></div> -->
          <div class="navsearch"><input type="text" class="tra7" id="inputValue" placeholder="区块哈希/区块高度/交易哈希/地址"></div>
        </div>
      </div>
      <!-- 移动端导航 -->
      <div class="m_nav">
        <a href="index.html" class="logo"></a>
        <a href="index.html" class="link tra1">Explorer</a>
        <div class="menustatus"></div>
        <div class="menudropdown">
          <div class="header"><input type="text" class="tra7" id="inputValue1" placeholder="区块哈希/区块高度/交易哈希/地址"><button type="button" id="search" class="tra23">搜索</button></div>
          <div class="linklist">
            <ul>
              <li><a href="index.html" class="tra2">Home</a></li>
              <li><a href="blockList.html" class="tra4">Block</a></li> 
              <li><a href="payList.html" class="tra5">Transaction</a></li>
              <!-- <li><a href="">未确认交易</a></li> -->
              <li><a href="https://github.com/ASMblock" class="tra6">About us</a></li>
              <li><a href="#" id="translate">English/简体中文
                  <label class="bui-switch-label bui-switch-animbg">
                      <input type="checkbox" id="translateInput" name="s"><i class="bui-switch"></i>
                      <span style="font-size:18px;margin:10px 10px;top:-7px;position:relative;"></span>
                    </label>
              </a></li>
            </ul>
          </div>
        </div>
      </div>
<div class="page">
  <div class="container" id="notMsg">
    <div class="container-fluid">
      <div class="row">
          <!-- 面包屑导航 -->
        <div class="breadbox">
            <ol class="breadcrumb">
                <li><a href="#" class="tra2">Home</a></li>
                <li><a href="#" class="tra29">Account</a></li>
                <li class="active tra30">Account Detail</li>
            </ol>
        </div>
        <div class="detailstitle">
            <span class="tra58">Address</span>
            <span class="address" id="address"></span>
        </div>
        <div class="accountbox clearfix">
            <div class="cxcbox col-lg-6">
                <div class="cxc_contaier">
                    <div class="cxcbox_text">
                        <h2>ASM <span class="tra59">Balance</span></h2>
                        <p id="balance"></p>
                    </div>
                    <div class="ctx_bottom">
                        <h3>USD</h3>
                        <p id="usd"></p>
                    </div>
                </div>
            </div>
            <div class="cxcdata col-lg-6">
                <div class="cxc_contaier">
                    <ul>
                        <li><span class="tra31">Coin Value:</span><div id="coin_value"></div></li>
                        <li><span class="tra32">Coin Type:</span><div id="coin_category"></div></li>
                        <li><span class="tra33">Coin Distribute:</span>
                        </li>
                    </ul>
                    <div class="circledata clearfix">
                        <div class="left">
                            <div id="echarts" style="width:80%;height:180px;"></div>
                        </div>
                        <div class="right">
                            <div class="head">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="account_tab">
            <ul class="clearfix">
                <li class="active tra60">Transaction Record</li>
            </ul>
        </div>
        <div class="datalistbox">
            <div class="dataitem show">

                <div class="body" style="overflow-x:auto;">
                    <table class="table table-hover" data-selectable="selectable" data-row-selectable="true" data-page-size="10">
                        <thead>
                            <tr>
                                <th class="tra52">Hash</th>
                                <th class="tra53">Time</th>
                                <th class="tra21">Sender</th>
                                <th class="tra22">Receiver</th>
                                <th class="tra61">Amount</th>
                                <th class="tra35">Type</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">

                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="12">
                                    <div class="page_sum pull-left">There are <span id="dataCount"></span> records in all.</div>
                                    <div class="page_math pull-right">
                                            <div style="text-align: center;">
                                                    <div id="pager" class="pager clearfix">
                                                    </div>
                                                </div>
                                    </div>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="footer">
  <div class="content">
      <p>© Copyright ASM 2019. All Rights Reserved</p>
  </div>
</div>

<div class="modal fade" id="lookerweima" aria-hidden="true" aria-labelledby="lookerweima" role="dialog" tabindex="-1">
    <div class="modal-dialog modal-center">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <h4 class="modal-title"></h4>
            </div>
            <div class="modal-body">
                <div class="modal_erweima"><img src="images/modal_erweima.png" alt=""></div>
            </div>
        </div>
    </div>
</div>

<script src="js/jquery.min.js?v=1.7"></script>
<script src="js/bootstrap.min.js?v=1.7"></script>
<script src="js/echarts.min.js?v=1.7"></script>
<script src="js/common.js?v=1.7"></script>
<script src="js/jquery.z-pager.js?v=1.7"></script>
<script src="js/index_details.js?v=1.7"></script>
<script>
    function getQueryVariable(variable)
    {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
                var pair = vars[i].split("=");
                if(pair[0] == variable){return pair[1];}
        }
        return(false);
    }

    
    function currentPage(currentPage){
        $.ajax({
                url: url + "/getPayList",
                type: "GET",
                data: {'address': getQueryVariable('address'), 'page':currentPage,'limit':'10'
                    },
                dataType:"json",
                success:function(result){
                    console.log(result)
                    if( result.code === 1) {
                        let data = result.data;
                        getData(data.list)
                    }
                },
                error:function(error){
                    alert('请求参数出错')
                  }
    
            });
    }

    let webUrl=window.location.protocol+"//"+window.location.hostname+':3000';
    let url = webUrl;

    function getBalanceDetail () {
        $.ajax({
            url: url + "/getBalanceDetail",
            type: "GET",
            data: {'address': getQueryVariable('address')},
            dataType:"json",
            success:function(result){
                console.log(result)
                if ( result.code === 1 ) {
                    let data = result.data;
                    $('#address').html(data.address);
                    $('#balance').html(data.balance);
                    $('#coin_category').html(data.coin_category);
                    $('#coin_value').html(data.coin_value);
                    $('#usd').html(data.usd);

                    
                    let echartsData = [
                        {value: data.rate, name:'持有'},
                        {value: 100 - data.rate, name: '未持有'},

                    ]
                    if ( data.rate === '100') {
                        echartsData = [{value: data.rate, name:'持有'}]
                    }
                    getEchart(echartsData)
                } else {
                    alert(result.msg)
                }
                
            },
            error:function(error){
                alert('请求参数出错')
              }

        });
        getPayList(getQueryVariable('address'),1)
    }
    getBalanceDetail()


    function getPayList (id, current) {
            $.ajax({
                url: url + "/getPayList",
                type: "GET",
                data: {'address': id, 'page':current,'limit':'10'
                    },
                dataType:"json",
                success:function(result){
                    console.log(result)
                    if( result.code === 1) {
                        let data = result.data;
                        
                        $('#dataCount').html(data.count)
                        $("#pager").zPager({
                            totalData: data.count,
                            // htmlBox: $('#wraper'),
                            btnShow: true,
                            ajaxSetData: false,
                        });
                        getData(data.list)
                    }else{
                        alert(result.msg)
                    }
                },
                error:function(error){
                    alert('请求参数出错')
                  }
    
            });
        }
    function getData (data) {
        let str = '';
        let html = '';
        data.forEach((item,i) => {
            if ( item.type === 1 ) {
                html = '<button class="btn btn-primary">IN</button>';
            } else if ( item.type === 2) {
                html = '<button class="btn btn-success">OUT</button>';
            }
            str += '<tr>' + 
                '<td><a href="payDetails.html?address='+item.pay_id+'">'+ item.pay_id + '</a></td>' + 
                '<td>' + item.createtime + '</td>' + 
                '<td><a href="index_details.html?address='+item.to_address+'"">' + item.to_address + '</a></td>' + 
                '<td><a href="index_details.html?address='+item.get_address+'"">' + item.get_address + '</a></td>' + 
                '<td>' + item.value + '</td>' + 
                '<td>' + html + '</td>' +
           ' </tr>'
        })
        $('#tbody').html(str)
    }
    function getEchart (data) {
        console.log(data)
        var myChart = echarts.init(document.getElementById('echarts'));
        myChart.setOption({
            tooltip: {
                trigger: 'item',
                confine:true,
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            color:['#fa8c26','#f6f7f8', '#35cccb','#965ff4', '#4dcc73', '#fa8b16','#fae337'],
            series: [
                {
                    name:'代币持仓分布',
                    type:'pie',
                    minAngle:10,
                    radius: ['70%', '90%'],
                    avoidLabelOverlap: false,
                    label: {
                        normal: {
                            show: false,
                            position: 'left'
                        },
                        emphasis: {
                            show: true,
                            textStyle: {
                                fontSize: '0',
                                fontWeight: 'bold'
                            }
                        }
                    },
                    labelLine: {
                        normal: {
                            show: false
                        }
                    },
                    data: data
                }
            ]
        });
    
        window.addEventListener('resize', function () {myChart.resize()});
    }
</script>
</body>
</html>